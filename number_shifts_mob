-- * Count the total number of shifts in Mobilize PAC. Useful right now to identify gaps in the combined chart, but should probably be removed later. *

-- Base table: https://platform.civisanalytics.com/spa/#/scripts/sql/101066205
---- This table contains all events, timeslots, and participants for those events in Mobilize, as well as the van event id to join with Every Action events.

WITH base AS (
SELECT *
  , ROW_NUMBER () OVER (PARTITION BY mob_eventid, mob_timeslotid) AS timeslot_dup
FROM coc_reporting.mob_eventattendance
)

SELECT
  COUNT (mob_timeslotid)
  		-- ^Since the base table has already deduplicated events and timeslots, I do NOT want to count distinct timeslots now since that will remove timeslots that are at the same time but for different events.
      -- ^
FROM base
WHERE timeslot_dup = 1
  

-- These lines for filtering in Sisense. !De-comment in Sisense!
-- AND [mob_eventstate=State]
--  AND [mob_eventtype=Event_Type]
--  AND [mob_eventowner=Event_Owner]

-- Can't include filter for event name in Sisense, which is referring to EA event name.